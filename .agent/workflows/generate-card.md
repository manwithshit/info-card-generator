---
description: 将文案或链接内容转换为精美的HTML信息卡片图片
---

# 文案/链接 转 精美信息卡片图片

当用户发送一段文案、一个Markdown文件、或一个URL链接时，自动生成精美的HTML信息卡片并截图保存为PNG图片。

## 触发方式

用户可以通过以下方式触发此工作流：
- `/generate-card` + 文案内容
- `/generate-card` + @[文件名.md]
- `/generate-card` + URL链接
- 直接说"帮我生成信息卡片"并附上内容

## 工作流步骤

### 1. 判断内容来源类型及获取优先级

根据用户输入判断内容来源并按优先级获取：

**情况 A：纯文本或 Markdown 文件**
- **直接使用**：读取内容并进入提取环节。
- **保存**：复制文件或创建新 md 到 `input/` 目录。

**情况 B：URL 链接**

按照以下优先级尝试获取内容：

1.  **视频类 - 优先级 1 (DownSub 字幕提取)**：针对 YouTube、Viki、Vlive 等视频平台，使用 DownSub 提取字幕。
2.  **视频类 - 优先级 2 (NotebookLM)**：如果 DownSub 无法获取字幕，走 NotebookLM 流程进行深度解析。
3.  **微信公众号 (`mp.weixin.qq.com`) - 直接使用浏览器代理**：
    - ⚠️ **Jina Reader 对微信公众号不可用**（超时/被拦截）
    - ✅ **直接使用 `browser_navigate` + `browser_snapshot` 抓取**
    - 微信公众号内容通过 JS 动态渲染，浏览器代理可完整获取
    - 详见下方「微信公众号专用抓取流程」
4.  **普通网页 - 优先级 1 (`read_url_content`)**：快速抓取文字。
5.  **普通网页 - 优先级 2 (浏览器子代理 `browser_subagent`)**：如果上述方式失败（如反爬、JS 渲染、登录可见等），通过浏览器代理模拟真实访问提取内容。
6.  **最终兜底 (NotebookLM)**：如果所有自动化提取手段均无法获得高质量内容，则使用 NotebookLM 作为最终解析手段。

### 2. DownSub 字幕提取流程（视频首选）

**适用条件：**
- ✅ YouTube、Viki、Vlive 等视频平台链接
- ✅ 需要获取视频完整字幕/文字稿

**执行步骤：**

1. 打开 DownSub (https://downsub.com/)
2. 在输入框粘贴视频链接
3. 点击「下载」按钮，等待解析完成
4. 选择字幕语言（优先选择原语言或英文）
5. 点击「TXT」按钮下载纯文本字幕
6. 将字幕内容保存到 `input/` 目录

**优势：**
- 无需登录，免费使用
- 直接获取纯净字幕文本
- 支持 SRT/TXT/RAW 多种格式

---

### 3. 微信公众号专用抓取流程

**适用条件：**
- ✅ URL 包含 `mp.weixin.qq.com`
- ✅ 公开可访问的公众号文章

**技术背景（参考 NeoFeed 双层抓取架构）：**

微信公众号作为封闭生态，面临三大挑战：
- **动态渲染**：文章主体通过异步脚本加载，单纯 fetch/curl 只能拿到空白框架
- **反爬策略**：对频繁请求的 IP 会重定向或封禁
- **私有协议**：图片采用 `data-src` 懒加载机制，存在防盗链限制

**执行步骤：**

1. **直接使用浏览器代理访问**
   ```
   browser_navigate → 目标 URL
   browser_snapshot → 获取页面结构化内容
   ```

2. **从 snapshot 中提取关键信息**
   - 标题：通常在 `heading [level=1]` 中
   - 作者/公众号名：在页面顶部元信息区
   - 发布时间：在元信息区的 `emphasis` 元素
   - 正文内容：所有 `paragraph` 元素的文本

3. **内容整理**
   - 浏览器 snapshot 返回结构化 YAML，可直接提取文本
   - 自动过滤广告、推荐文章等噪音
   - 保留图片描述（`img` 元素的 alt 文本）

**优势：**
- ✅ **成功率高**：浏览器完整渲染 JS，获取动态内容
- ✅ **无需 Jina**：Jina Reader 对微信公众号超时/失败
- ✅ **结构化输出**：snapshot 直接返回可解析的 YAML 格式
- ✅ **无反爬问题**：模拟真实用户访问

**注意事项：**
- 仅粉丝可见的文章需要用户已登录微信
- 如遇验证码页面，可能需要用户手动完成验证后重试

---

### 4. NotebookLM 流程（兜底方案）

**适用条件：**
- ✅ DownSub 无法获取字幕的视频。
- ✅ 多次尝试自动提取均告失败的网页。
- ✅ 内容极其复杂，需要 AI 深度整理的长篇文档。

**执行步骤：**

1. 打开 NotebookLM (https://notebooklm.google.com/)
2. 检查登录状态，如未登录则等待用户登录
3. **创建新笔记本**，命名格式：`[YYMMDD]_主题名`
   - ⚠️ 不要复用已有笔记本，避免内容混杂
4. 添加 URL 作为来源（通过"网站"选项）
5. 等待内容解析完成
6. 在 Studio 面板选择 **"简报文档"** 生成报告
7. 等待报告生成完成
8. 复制报告全文
9. 保存到 `input/` 目录
10. （可选）使用完成后删除或归档该笔记本

### 5. 保存原始输入到 `input/`

无论采用哪种方式获取内容，都需要保存原始输入：

- **Markdown文件**：复制到 `input/` 文件夹
- **URL链接**：创建md文件保存抓取/解析的内容
- **纯文本**：创建md文件保存原始文案

**⚠️ 文件命名规范（重要）**

所有保存到 `input/` 的 md 文件必须以日期前缀开头：

- **格式**: `[YYMMDD]文件名.md`
- **示例**: `[260107]Google_A2UI技术科普介绍.md`
- **日期**: 使用**当前处理日期**（即生成该 md 文件的日期，6位数字，年月日各2位）

### 6. 提取信息并生成HTML卡片

**⚠️ 必须参考并遵循以下Skill文件中的设计规范：**

📂 **主要Skill**: `skills/skills/frontend-design/SKILL.md`
📂 **辅助参考**: `skills/skills/canvas-design/SKILL.md`

---

## ⭐ 卡片内容规范（重要）

### 信息量原则

**不要过度精简！** 原始内容通常很丰富，在页面尺寸允许的情况下：

1. **保留更多核心信息**
   - 如果原文有7个要点，不要压缩成4个
   - 小标题、子要点都可以保留
   - 重要的细节描述不要省略

2. **通过视觉层次区分主次**
   - **主要信息**：大字号、醒目颜色、显著位置
   - **次要信息**：小字号、浅色、辅助位置
   - **细节信息**：更小字号、列表形式、折叠区域

3. **建议的内容结构**
   ```
   ┌────────────────────────────────────────┐
   │  标题 + 标签 + 元信息                    │
   ├────────────────────────────────────────┤
   │  执行摘要（2-3句话概述）                  │
   ├────────────────────────────────────────┤
   │  核心要点 × 4-6个（带详细描述）           │
   │    ├─ 要点1：标题 + 说明（30-50字）      │
   │    ├─ 要点2：标题 + 说明                │
   │    └─ ...                              │
   ├────────────────────────────────────────┤
   │  关键细节/子要点（可选）                  │
   │    ├─ 列表项1                          │
   │    ├─ 列表项2                          │
   │    └─ ...                              │
   ├────────────────────────────────────────┤
   │  精选语录                               │
   ├────────────────────────────────────────┤
   │  数据/统计 × 3-5个                      │
   ├────────────────────────────────────────┤
   │  来源信息                               │
   └────────────────────────────────────────┘
   ```

4. **页面尺寸规范（重要）**
   - **基准尺寸**: 宽度 900px，高度建议 800px - 1270px（A4 比例）
   - **宽度弹性扩展**: 如果内容信息量较大，可以适当扩展宽度至 1000px - 1200px
   - **高度自适应**: 高度根据内容自动撑开，不设置 `max-height` 或 `overflow: hidden`
   - **内容精简优先**: 当内容过多时，优先通过精简文字、压缩描述来适配尺寸
   - **布局调整策略**: 
     - 使用更紧凑的 Grid 布局（如 3 列代替 2 列）
     - 减少 padding/margin
     - 使用更小的字号层级
     - 合并相似要点

5. **CSS 规范（重要）**
   - ⚠️ **禁止使用** `max-height` + `overflow: hidden`，会导致内容被截断
   - ✅ 使用 `min-height` 设置最小高度
   - ✅ 卡片容器使用固定 `width`，高度自适应
   - 截图脚本会自动处理外边距，无需在 HTML 中设置 body padding
   - ❌ **截图自动去除白边**：脚本会注入样式移除 margin/padding 并透明化背景，直接截取卡片元素

### 要避免的问题

❌ 把10个要点压缩成4个
❌ 只保留标题，省略说明文字
❌ 重要细节被删除
❌ 卡片太短，信息密度低

---

### 7. 使用Playwright截图

// turbo
运行截图脚本生成PNG图片：
```bash
cd /Users/earonwong/Desktop/个人随手记录/output/cards/[卡片名称] && node ../../../scripts/capture_card.js [卡片名称].html
```

### 8. 输出结果

向用户展示：
- 生成的图片路径
- 原始输入文件保存路径
- 简要说明卡片内容

---

## 目录结构

```
/Users/earonwong/Desktop/个人随手记录/
├── input/                          # 原始输入文件
├── output/cards/                   # 生成的卡片
│   └── [topic_name]/
│       ├── [topic_name].html
│       └── [topic_name].png
├── scripts/
│   └── capture_card.js             # 截图脚本
└── skills/skills/
    ├── frontend-design/SKILL.md    # 前端设计Skill
    └── canvas-design/SKILL.md      # 视觉设计Skill
```

## 语言规范

- **最终输出**：HTML和PNG必须是 **中文**
- 即使原始内容是英文，卡片上的所有文字（标题、要点、描述等）都需要翻译成中文

## 依赖项

- Node.js
- playwright
- Chromium浏览器

## 外部工具配置

### DownSub（视频字幕提取）
- **网址**: https://downsub.com/
- **用途**: 提取 YouTube 等视频平台的字幕
- **特点**: 免费、无需登录、支持多种格式

### NotebookLM（深度解析兜底）
- **网址**: https://notebooklm.google.com/
- **笔记本策略**: 每次创建独立笔记本，命名格式 `[YYMMDD]_主题名`
- **注意**: ⚠️ 不要复用笔记本，否则生成简报时会混杂所有来源内容
