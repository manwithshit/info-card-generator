---
description: 将文案或链接内容转换为精美的HTML信息卡片图片
---

# 文案/链接 转 精美信息卡片图片

当用户发送一段文案、一个Markdown文件、或一个URL链接时，自动生成精美的HTML信息卡片并截图保存为PNG图片。

## 触发方式

用户可以通过以下方式触发此工作流：
- `/generate-card` + 文案内容
- `/generate-card` + @[文件名.md]
- `/generate-card` + URL链接
- 直接说"帮我生成信息卡片"并附上内容

## 工作流步骤

### 1. 判断内容来源类型及获取优先级

根据用户输入判断内容来源并按优先级获取：

**情况 A：纯文本或 Markdown 文件**
- **直接使用**：读取内容并进入提取环节。
- **保存**：复制文件或创建新 md 到 `input/` 目录。

**情况 B：URL 链接**

按照以下优先级尝试获取内容：

1.  **视频类（YouTube 等）** → 见下方「视频内容提取决策树」
2.  **微信公众号 (`mp.weixin.qq.com`)** → 见下方「3. 微信公众号专用抓取流程」
3.  **X (Twitter) (`x.com` / `twitter.com`)** → 见下方「X/Twitter 专用抓取流程」
4.  **普通网页 - 优先级 1** → `read_url_content` 快速抓取
5.  **普通网页 - 优先级 2** → 浏览器子代理（反爬/JS渲染场景）
6.  **最终兜底** → NotebookLM 深度解析

---

### 2. 视频内容提取决策树（⚡ 优化后）

**⚠️ 核心原则：减少无效尝试，快速判断最优路径**

```
┌─────────────────────────────────────────────────────────────┐
│                    检测到视频链接                             │
│              (YouTube/Viki/Vlive/Bilibili等)                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  Step 2.1: 快速预判断（使用 read_url_content）                │
│  ─────────────────────────────────────────────              │
│  读取视频页面，提取视频标题                                    │
└─────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              │                               │
              ▼                               ▼
    ┌─────────────────┐             ┌─────────────────┐
    │  标题是英文？    │             │  标题是中文/    │
    │                 │             │  日文/韩文等？   │
    └─────────────────┘             └─────────────────┘
              │                               │
              ▼                               ▼
    ┌─────────────────┐             ┌─────────────────┐
    │  尝试 DownSub   │             │  🚀 直接走      │
    │  （限时30秒）    │             │  NotebookLM    │
    └─────────────────┘             │  （跳过DownSub）│
              │                     └─────────────────┘
      ┌───────┴───────┐
      │               │
      ▼               ▼
  成功提取          失败/超时
      │               │
      ▼               ▼
  保存字幕      🚀 直接走 NotebookLM
                  （不再尝试其他工具）
```

#### Step 2.1: 视频语言预判断

// turbo
```bash
# 使用 read_url_content 快速获取视频页面
# 从返回内容中提取视频标题
```

**判断规则：**
| 视频标题语言 | 执行路径 | 原因 |
|-------------|---------|------|
| **英文** | 先尝试 DownSub，失败再 NotebookLM | DownSub 对英文字幕支持较好 |
| **中文/日文/韩文** | **直接 NotebookLM** | DownSub 对非英文视频成功率极低 |
| **无法判断** | 直接 NotebookLM | 保守策略，避免浪费时间 |

#### Step 2.2: DownSub 字幕提取（仅英文视频）

**适用条件：**
- ✅ 仅当 Step 2.1 判断为英文视频时执行
- ✅ 设置 **30秒超时限制**

**执行步骤：**
1. 打开 DownSub (https://downsub.com/)
2. 粘贴视频链接，点击下载
3. **等待最多30秒**：
   - 若出现 "Subtitles not found" → **立即终止，转 NotebookLM**
   - 若出现字幕列表 → 下载 TXT 格式
4. 保存字幕内容到 `input/` 目录

**⚠️ 快速失败规则：**
- 30秒内无结果 → 立即切换 NotebookLM
- 出现任何错误提示 → 不再重试其他字幕工具
- ❌ 禁止尝试 SaveSubs/YouSubtitles 等类似工具（成功率相近，浪费时间）

#### Step 2.3: NotebookLM 视频解析（主要路径）

**适用条件：**
- ✅ 非英文视频（中文/日文/韩文等）
- ✅ DownSub 失败或超时
- ✅ 任何需要深度解析的视频

**优势：**
- 🎯 支持所有语言的视频
- 🎯 自动生成结构化的内容摘要
- 🎯 成功率 > 95%

详见下方「NotebookLM 流程」章节。

---

### 2.4 DownSub 工具说明（仅供参考）

**优势：**
- 无需登录，免费使用
- 直接获取纯净字幕文本
- 支持 SRT/TXT/RAW 多种格式

**局限性：**
- ❌ 对中文/日文/韩文视频支持差
- ❌ 部分视频无可提取字幕
- ❌ 自动生成字幕可能无法提取

---

### 3. 微信公众号专用抓取流程

**适用条件：**
- ✅ URL 包含 `mp.weixin.qq.com`

**执行优先级：**

#### 3.1 🚀 自动化路径（静默执行 - 无头模式）
这是首选的获取方式，利用无头浏览器在后台快速抓取。

**执行命令：**
// turbo
```bash
python scripts/crawl_wechat.py "[URL]" "input/[YYMMDD]WeChat_Content.md"
```

*注：此步骤由于标记了 `// turbo`，将自动静默运行，不会弹窗请求确认。*

#### 3.2 🛠️ 交互式路径（手动兜底 - 真实浏览器）
如果上述脚本失败（报错、被拦截或返回空内容），则切换至此路径。

**执行步骤：**
1. **启动浏览器子代理**
   使用 `browser_navigate` 和 `browser_snapshot`。
   *注：此步骤涉及动态网页访问和真实身份环境，我会设为 `SafeToAutoRun: false`，**系统会弹窗请求你确认**。*

2. **从 snapshot 中提取信息**
   - 标题：通常在 `heading [level=1]` 中
   - 作者/公众号名：在页面顶部元信息区
   - 正文内容：优先抓取 `#js_content` 的 `innerText` 内容，确保完整
   - 自动过滤广告和干扰信息

**优势：**
- ✅ **首选提效**：大部分文章通过自动化脚本直接秒杀，无需用户操作。
- ✅ **强制安全**：一旦进入手动兜底阶段，通过弹窗确认保护用户隐私和登录态安全。
- ✅ **结构化输出**：无论哪条路径，最终都保存为规范的 Markdown 原文。

**注意事项：**
- 仅粉丝可见的文章需要用户在手动模式下确保已登录微信。
- 如遇验证码页面，请在手动模式下完成验证。

---

### 3.5 X/Twitter 专用抓取流程

**适用条件：**
- ✅ URL 包含 `x.com` 或 `twitter.com`

**执行步骤：**

1. **调用自动化抓取脚本**
   利用 Playwright 模拟浏览器环境，规避基本的反爬虫限制。

   // turbo
   ```bash
   python scripts/crawl_x.py "[URL]" "input/[YYMMDD]X_Content.md"
   ```

2. **内容处理**
   - 脚本会自动解析推文文案、作者 Handle 等信息。
   - 若脚本失败，则回退到浏览器子代理或 NotebookLM。

**优势：**
- ✅ **全自动执行**：带有 `// turbo` 标注，无需用户点击确认。
- ✅ **结构化**：针对 X 的页面布局进行了定制化提取。

---

### 4. NotebookLM 流程（🌟 视频主要路径 & 兜底方案）

**适用条件：**
- ✅ **非英文视频**（中文/日文/韩文等）— **直接使用，不尝试 DownSub**
- ✅ DownSub 失败或超时的英文视频
- ✅ 多次尝试自动提取均告失败的网页
- ✅ 内容极其复杂，需要 AI 深度整理的长篇文档

**执行步骤：**

1. 打开 NotebookLM (https://notebooklm.google.com/)
2. 检查登录状态，如未登录则等待用户登录
3. **创建新笔记本**，命名格式：`[YYMMDD]_主题名`
   - ⚠️ 不要复用已有笔记本，避免内容混杂
4. 添加 URL 作为来源（通过"网站"选项）
5. 等待内容解析完成
6. 在 Studio 面板选择 **"简报文档"** 生成报告
7. 等待报告生成完成
8. **点击全文拷贝按钮（关键操作）**：
   - 在生成的简报文档（Briefing Document）正上方或右侧操作栏，寻找 **"双矩形叠加"图标**（鼠标悬停显示 `Copy content with formatting`）。
   - **严禁**：严禁直接从页面划词选中，或使用子代理尝试总结内容，这会导致信息量严重折损。
   - **必须**：通过子代理模拟物理点击该按钮，确保获取到的内容是 100% 完整、带格式且未经二次压缩的原文。
9. 保存到 `input/` 目录
10. （可选）使用完成后删除或归档该笔记本

### 5. 保存原始输入到 `input/`

**⚠️ 核心原则：保存原文，不做摘要**

无论采用哪种方式获取内容，都需要保存**完整的原始内容**：

- **Markdown文件**：复制到 `input/` 文件夹
- **URL链接**：创建md文件保存**完整抓取的原文**
- **纯文本**：创建md文件保存原始文案

**🚫 禁止行为：**
- ❌ 不要在保存时自动做摘要/精简
- ❌ 不要只保存"关键要点"
- ❌ 不要用浏览器子代理返回的"总结报告"替代原文

**✅ 正确做法：**
- ✅ 保存抓取到的**完整文本内容**
- ✅ 对于长文章，保留所有段落和细节
- ✅ 摘要/精简工作留到「生成HTML卡片」步骤进行

**📝 微信公众号文章抓取时的注意事项：**
- 浏览器子代理 Task 中必须明确要求：**"返回完整的文章正文，不要做摘要"**
- 使用 JavaScript 提取 `#js_content` 的 `innerText` 时，确保获取并返回全部文本

**⚠️ 文件命名规范（重要）**

所有保存到 `input/` 的 md 文件必须以日期前缀开头：

- **格式**: `[YYMMDD]文件名.md`
- **示例**: `[260107]Google_A2UI技术科普介绍.md`
- **日期**: 使用**当前处理日期**（即生成该 md 文件的日期，6位数字，年月日各2位）

### 6. 提取信息并生成HTML卡片

**⚠️ 必须参考并遵循以下Skill文件中的设计规范：**

📂 **主要Skill**: `skills/info-card-design/SKILL.md`
📂 **辅助参考**: 根据项目实际情况调整

---

## ⭐ 卡片内容规范（重要）

### 信息量原则

**不要过度精简！** 原始内容通常很丰富，在页面尺寸允许的情况下：

1. **保留更多核心信息**
   - 如果原文有7个要点，不要压缩成4个
   - 小标题、子要点都可以保留
   - 重要的细节描述不要省略

2. **通过视觉层次区分主次**
   - **主要信息**：大字号、醒目颜色、显著位置
   - **次要信息**：小字号、浅色、辅助位置
   - **细节信息**：更小字号、列表形式、折叠区域

3. **建议的内容结构**
   ```
   ┌────────────────────────────────────────┐
   │  标题 + 标签 + 元信息                    │
   ├────────────────────────────────────────┤
   │  执行摘要（2-3句话概述）                  │
   ├────────────────────────────────────────┤
   │  核心要点 × 4-6个（带详细描述）           │
   │    ├─ 要点1：标题 + 说明（30-50字）      │
   │    ├─ 要点2：标题 + 说明                │
   │    └─ ...                              │
   ├────────────────────────────────────────┤
   │  关键细节/子要点（可选）                  │
   │    ├─ 列表项1                          │
   │    ├─ 列表项2                          │
   │    └─ ...                              │
   ├────────────────────────────────────────┤
   │  精选语录                               │
   ├────────────────────────────────────────┤
   │  数据/统计 × 3-5个                      │
   ├────────────────────────────────────────┤
   │  来源信息                               │
   └────────────────────────────────────────┘
   ```

4. **页面尺寸规范（重要）**
   - **基准尺寸**: 宽度 900px，高度建议 800px - 1270px（A4 比例）
   - **宽度弹性扩展**: 如果内容信息量较大，可以适当扩展宽度至 1000px - 1200px
   - **高度自适应**: 高度根据内容自动撑开，不设置 `max-height` 或 `overflow: hidden`
   - **内容精简优先**: 当内容过多时，优先通过精简文字、压缩描述来适配尺寸
   - **布局调整策略**: 
     - 使用更紧凑的 Grid 布局（如 3 列代替 2 列）
     - 减少 padding/margin
     - 使用更小的字号层级
     - 合并相似要点

5. **CSS 规范（重要）**
   - ⚠️ **禁止使用** `max-height` + `overflow: hidden`，会导致内容被截断
   - ✅ 使用 `min-height` 设置最小高度
   - ✅ 卡片容器使用固定 `width`，高度自适应
   - 截图脚本会自动处理外边距，无需在 HTML 中设置 body padding
   - ❌ **截图自动去除白边**：脚本会注入样式移除 margin/padding 并透明化背景，直接截取卡片元素

### 要避免的问题

❌ 把10个要点压缩成4个
❌ 只保留标题，省略说明文字
❌ 重要细节被删除
❌ 卡片太短，信息密度低

---

### 7. 使用Playwright截图

// turbo
运行截图脚本生成PNG图片：
```bash
cd output/cards/[卡片名称] && node ../../scripts/capture_card.js [卡片名称].html
```

### 8. 输出结果

向用户展示：
- 生成的图片路径
- 原始输入文件保存路径
- 简要说明卡片内容

---

## 目录结构

```
info-card-generator/
├── input/                      # 原始内容（Markdown 格式）
├── output/
│   └── cards/                  # 生成的卡片（HTML + PNG）
│       └── [card_name]/
│           ├── [card_name].html
│           └── [card_name].png
├── scripts/
│   ├── capture_card.js         # Playwright 截图脚本
│   ├── crawl_wechat.py         # 微信公众号抓取脚本（可选）
│   └── crawl_x.py              # X/Twitter 抓取脚本（可选）
├── .agent/
│   └── workflows/
│       └── generate-card.md    # AI 工作流定义
└── skills/
    └── info-card-design/
        └── SKILL.md            # AI Skill 定义
```

## 语言规范

- **最终输出**：HTML和PNG必须是 **中文**
- 即使原始内容是英文，卡片上的所有文字（标题、要点、描述等）都需要翻译成中文

## 依赖项

- Node.js
- playwright
- Chromium浏览器
- Python 3（用于可选的内容抓取脚本）

## 外部工具配置

### DownSub（视频字幕提取 - 仅限英文视频）
- **网址**: https://downsub.com/
- **用途**: 提取 YouTube 等视频平台的英文字幕
- **特点**: 免费、无需登录、支持多种格式
- **⚠️ 局限性**: 
  - 对中文/日文/韩文视频支持差
  - 超时限制：30秒无结果应立即放弃
  - ❌ 不要尝试 SaveSubs/YouSubtitles 等类似工具

### NotebookLM（🌟 视频主要路径 & 深度解析兜底）
- **网址**: https://notebooklm.google.com/
- **笔记本策略**: 每次创建独立笔记本，命名格式 `[YYMMDD]_主题名`
- **注意**: ⚠️ 不要复用笔记本，否则生成简报时会混杂所有来源内容
- **✅ 优势**:
  - 支持所有语言的视频
  - 自动生成结构化的内容摘要
  - 成功率 > 95%
  - 对于非英文视频，直接使用 NotebookLM（跳过 DownSub）
